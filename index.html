<!DOCTYPE html>
<html lang="en">
    <head>
      <style>
      body{
        background-color: #FFFFFF;
      }
      </style>
      <meta charset="utf-8" />
      <title></title>
    </head>
    <body>
        <form id="input">
          Дистанция до цели:<br>
          <input type="text" name="distance"><br>
          Высота вашей позиции:<br>
          <input type="text" name="operatorElevation"><br>
          Высота позиции противника:<br>
          <input type="text"  name="targetElevation"><br><br>
          <input type="submit" onclick="return calculate()" value="Рассчитать поправку"><br>
        </form>
        <div id=result>
        </div>
        <script>
            function calculate()
            {
                var distance = 200;
                var correction;
                var result;
                var targetElevation;
                var operatorElevation;
                var data = [
                {Tdistance: 100, Tcorrection: 8},
                {Tdistance: 150, Tcorrection: 9},
                {Tdistance: 200, Tcorrection: 16},
                {Tdistance: 250, Tcorrection: 26},
                {Tdistance: 300, Tcorrection: 38},
                {Tdistance: 350, Tcorrection: 50},
                {Tdistance: 400, Tcorrection: 61},
                {Tdistance: 450, Tcorrection: 72},
                {Tdistance: 500, Tcorrection: 82},
                {Tdistance: 550, Tcorrection: 91},
                {Tdistance: 600, Tcorrection: 100},
                {Tdistance: 650, Tcorrection: 109},
                {Tdistance: 700, Tcorrection: 119},
                {Tdistance: 750, Tcorrection: 130},
                {Tdistance: 800, Tcorrection: 141},
                {Tdistance: 850, Tcorrection: 155},
                {Tdistance: 900, Tcorrection: 169},
                {Tdistance: 950, Tcorrection: 185},
                {Tdistance: 1000, Tcorrection: 202},
                {Tdistance: 1050, Tcorrection: 220},
                {Tdistance: 1100, Tcorrection: 239},
                {Tdistance: 1150, Tcorrection: 257},
                {Tdistance: 1200, Tcorrection: 276},
                {Tdistance: 1250, Tcorrection: 295},
                {Tdistance: 1300, Tcorrection: 314},
                {Tdistance: 1350, Tcorrection: 333},
                {Tdistance: 1400, Tcorrection: 354},
                {Tdistance: 1450, Tcorrection: 378},
                {Tdistance: 1500, Tcorrection: 407},
                {Tdistance: 1550, Tcorrection: 443},
                {Tdistance: 1600, Tcorrection: 492},
                {Tdistance: 1650, Tcorrection: 558},
                {Tdistance: 1700, Tcorrection: 648},
                ];
                var distance = document.forms["input"]["distance"].value;
                var operatorElevation = document.forms["input"]["operatorElevation"].value;
                var targetElevation = document.forms["input"]["targetElevation"].value;
                result = getNearest(data, distance);
                var output = elevation(distance, targetElevation, operatorElevation, result.Tcorrection);
                document.getElementById("result").innerHTML = output;
                return false;
            }
            //correction. = (667 - 0.233719 * Math.sqrt(10361381.5881 - Math.pow(distance+1488.91 , 2)));
            //Expression above doesnt work, will use ingame table instead
//////////////////////////////////////////////////////////////////////////////////////
                function getNearest(array, value)
                {
                    var closest, difference, lastDifference = null;
                    for (var i = 0; i < array.length; i++) {
                        difference = Math.abs(array[i].Tdistance - value);
                        if (value > 1675) {
                            return array[32];
                        } else if (lastDifference === null || difference < lastDifference) {
                            closest = i;
                            lastDifference = difference;
                        } else {
                            return array[closest];
                        }
                    }
                    return null;
                }

                function elevation(distance, targetElevation, operatorElevation, correction)
                {
                    if (targetElevation > operatorElevation) {
                    var result = correction + (1000*(targetElevation - operatorElevation)/distance);
                    }
                    else {
                        var result = correction + (1000*(targetElevation - operatorElevation)/distance);
                    }
                    return result;
                }
//////////////////////////////////////////////////////////////////////////////////////

        </script>
    </body>
</html>
